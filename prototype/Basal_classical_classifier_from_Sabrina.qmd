---
title: "Basal classical calssifier from Sarbina"
format: html
editor: visual
---


```{r}
# auto generated predictor function

predict.class <- function(mat,mode="pred",zero.fill=F) {
	gg<-strsplit("ABCF3,AC005538.2,AC092045.1,AC097493.3,AC105916.2,AC106795.1,AC136443.1,AC245041.2,ACER2,ACOT9,ACSS2,ACTN4,ADCY6,ADGRF1,AGAP6,AHCY,AIFM3,AIG1,AKR1B10,AL133268.1,AL137782.1,AL358232.1,AL359955.1,AL365436.2,AMPD2,ANG,ANKRD11,ANKRD61,ANXA8,API5P2,APOBEC3G,APP,ARFGAP1,ARFGEF3,ARHGAP23,ARL16,ASAP1,ASAP2,ATP2A3,AXL,BCAS1,BCKDK,BEAN1,BICC1,BICD1,BNIP5,BTNL8,BX679664.3,C12orf54,C16orf74,CABLES1,CACNA2D2,CAD,CADPS,CAMK2N1,CAPN5,CAPN8,CAPN9,CAV1,CAVIN2,CCDC57,CCDC82,CCNDBP1,CCT8,CD47,CDC42BPA,CDK14,CEACAM3,CEACAM5,CEACAM6,CEACAM7,CEMIP,CEP295NL,CES2,CFAP52,CHST11,CKAP4,CLCA2,CLDN18,CLIP4,COL17A1,CRACD,CREB3L1,CRYL1,CST6,CSTA,CTNS,CTSE,CXCL3,CYP2S1,CYP3A5,DHX33,DNAJC22,DOP1B,DSE,DSG3,DYNC2H1,E2F4,EDN1,EDN3,EPS8L1,ERG28,ETV5,FAIM,FAM177B,FAM222A,FAM227A,FAM83E,FARP2,FAT2,FBRSL1,FBXL18,FBXO17,FBXW5,FER1L6,FEZ2,FGF13,FGFRL1,FHL2,FMO5,FST,FYTTD1,GAB2,GADD45A,GADD45B,GALK1,GALM,GATA6,GATD3B,GID8,GM2A,GP2,GPAA1,GPX2,GRIP2,GRN,GSDMC,GULP1,HACD1,HAUS6P1,HCAR2,HCAR3,HEPH,HMGA1P8,HMGA2,HMGB1P6,HMGCS2,HNF4A,HNRNPA1P33,HSD17B7,INPP4B,INTS1,IQGAP2,ITGB6,ITPR2,IYD,KALRN,KAT14,KCNE3,KCNJ3,KIAA0556,KITLG,KLK6,KRT13,KRT5,KRT6A,KRT6C,KRT8,LAMB3,LAT,LCMT1,LEPROT,LFNG,LGR4,LINC01124,LMO7,LPAR3,LPCAT4,LRRC66,MAFF,MAP7,MARCKSL1,MCU,MDFIC,MDH1B,MECOM,MGAT3,MIR151A,MIR186,MIR205HG,MIR548I2,MIR569,MIR595,MIR6765,MIRLET7BHG,MIRLET7I,MKNK2,MPZL2,MTSS1,MUC3A,MXRA5,MYRF,NDUFAF4,NGEF,NGFR,NMUR2,NOL4L,NR1I2,NR3C2,NT5C1B,NUP58,NUTM1,ODF3B,OR7E14P,PADI1,PAQR7,PAQR8,PCDH7,PCMT1,PDE11A,PDIK1L,PDX1,PFAS,PGLYRP3,PHACTR3,PHB2,PHF3,PIK3C2B,PIP5K1B,PLA2G10,PLAAT3,PLAC9,PLAT,PLAU,PLEKHA7,PLK2,PLSCR2,PMAIP1,POF1B,POLRMTP1,PPIAP72,PPL,PPP1R18,PPP4R4,PREP,PRKAR1B,PRKDC,PRR15L,PRSS53,PSMC1P2,PYCR1,RAB20,RAPGEFL1,RAPSN,RBM23,RBP1,RCAN1,RDX,REEP1,REG4,REP15,REPIN1,REXO2,RFC2,RHCG,RHOV,RIPK2,RPF2,RPL7AP66,RPL7P1,RPS15P4,RSL1D1,S100A8,SAA2,SCEL,SEC63,SELENBP1,SELENOM,SESTD1,SF3B5,SH3BGRL2,SH3GLB2,SLC10A3,SLC26A9,SLC2A9,SLC41A2,SLC43A1,SLC7A6OS,SLCO3A1,SMIM6,SNCG,SOX21,SRRM2,SRXN1,ST13,ST6GALNAC1,ST6GALNAC4,STARD5,STIP1,SYTL2,TBRG4,TENT5C,TFF1,TGFB2,TGFBR2,TGM2,THOC3,THSD7A,TM9SF1,TMCC3,TMEM45A,TMPRSS2,TNIK,TP63,TPD52,TPD52L2,TRPA1,TSPAN8,TTPAL,TYMP,UACA,UBE2L6,UBE2V1P2,UBE3D,UBFD1,USP31,VEZT,VMP1,VSIG1,VSIG2,VSTM2L,WFDC5,WWTR1,ZNF185,ZNF385A,ZNF438,ZNF512B,ZNF527,ZNF598,ZNF668,ZNF746,ZPLD1",",")[[1]];
	gp<-c(146,207,168,257,23,220,43,12,182,73,252,231,163,38,323,44,99,204,308,62,290,215,119,321,148,336,305,255,30,3,237,103,317,262,251,48,109,240,114,278,226,140,309,20,118,106,301,126,135,17,155,111,77,271,61,117,175,318,179,120,300,208,229,82,153,56,329,70,79,239,68,72,88,41,47,159,90,156,69,115,183,7,303,248,108,83,193,209,105,228,58,222,253,250,200,91,313,230,57,330,19,277,174,186,212,46,151,184,36,75,234,322,213,325,35,273,1,43,104,45,188,8,288,289,169,195,27,149,254,258,328,67,137,194,107,291,116,29,320,264,122,279,333,31,59,327,306,274,263,218,189,172,216,236,139,10,268,341,130,324,283,302,124,64,32,211,295,60,272,319,25,310,197,261,98,276,16,269,270,203,246,280,28,2,167,141,166,142,110,78,265,165,335,298,266,6,86,190,244,121,273,285,205,314,49,164,199,307,96,326,311,131,332,224,177,198,14,202,178,81,154,292,101,233,176,225,151,149,8,24,231,334,215,275,97,286,63,330,242,331,206,299,112,92,37,76,223,337,219,247,267,32,304,234,170,145,136,33,297,294,40,238,306,144,53,42,256,129,95,227,113,125,185,152,85,340,133,249,80,293,316,339,15,282,124,18,243,171,50,338,83,287,222,5,94,11,179,153,129,132,26,281,158,74,4,173,229,127,303,120,260,82,160,245,148,102,210,100,54,147,157,128,296,34,143,39,84,217,123,315,134,71,181,284,191,9,221,312,52,150,162,232,55,43,214,259,187,65,70,21,151,342,161,241,13,196,201,22,235,66,56,180,138,89,51,87,93,192);
	gc<-c(0,31,57,106,156,184);
	nsig <- length(gc)-1;
	ll<-gc[length(gc)];
	if(mode=="mat") {
		r <- list(gps=list(),gg=gg);
		for(i in 1:nsig) {
			i1 <- (gc[i]+1):(gc[i+1]);
			r$gps[[i]] <- data.frame(g1=gg[gp[i1]],g2=gg[gp[ll+i1]],cls=i,stringsAsFactors=F);
		}
		return(r);
	}
	if(is.matrix(mat)) {
		ix<-match(gg,rownames(mat));
	} else if(is.data.frame(mat)) {
		mat <- as.matrix(mat);
		ix<-match(gg,rownames(mat));
	} else {
		stop("unknown data type");
		ix<-match(gg,an<-names(mat));
		mat <- matrix(mat,length(mat),1);
		rownames(mat) <- an;
	}
	nsam <- ncol(mat);

	r <- data.frame(pred=rep(NA,nsam),score=NA,type=NA,stringsAsFactors=F);
	c3 <- c3p <- c3n <- matrix(0,nsig,nsam);
	l3 <- matrix(0,2,nsam);
	gvm <- mat[ix,];
	if(zero.fill) gvm[is.na(gvm)] <- 0;
	pscore <- (gvm[gp[1:ll],]<gvm[gp[ll+(1:ll)],]);
	nscore <- (gvm[gp[1:ll],]>gvm[gp[ll+(1:ll)],]);
	mscore <- matrix(NA,nsam,4*nsig);
	for(i in 1:nsig) {
		i1 <- (gc[i]+1):(gc[i+1]);
		mscore[,i*4-3] <- colSums(is.na(pscore[i1,]) | gvm[gp[1:ll][i1],]==gvm[gp[ll+(1:ll)][i1],]);
		mscore[,i*4-2] <- colSums(nscore[i1,],na.rm=T);
		mscore[,i*4-1] <- colSums(pscore[i1,],na.rm=T);
		mscore[,i*4  ] <- 1+(mscore[,i*4-1]<mscore[,i*4-2]);
	}

	# 3,5,6,7,8
	i5 <- which(is.na(r$pred) & mscore[,16]==1);
	r$pred[i5] <- c("ClassicA","ClassicB")[mscore[i5,8]];
	i5 <- which(is.na(r$pred) & mscore[,12]==1);
	r$pred[i5] <- c("BasalA","BasalB")[mscore[i5,4]];
	i5 <- which(is.na(r$pred));
	r$pred[i5] <- c("hybrid","ClassicA")[mscore[i5,20]];

	attr(r$pred,"mscore") <- mscore;
	return(r$pred);
}


```

